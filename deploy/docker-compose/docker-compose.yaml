services:
  gorestic-backup:
    image: ghcr.io/fgeck/gorestic-homelab:latest
    container_name: gorestic-backup
    command: ["run", "--config", "/config/config.yaml"]
    environment:
      - RESTIC_PASSWORD=${RESTIC_PASSWORD}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      - TELEGRAM_CHAT_ID=${TELEGRAM_CHAT_ID}
    volumes:
      - ./config.yaml:/config/config.yaml:ro
      - ${BACKUP_DATA_PATH:-/data}:/data:ro
      - ${SSH_KEY_PATH:-~/.ssh/id_rsa}:/root/.ssh/id_rsa:ro
    # Uncomment for Wake-on-LAN support (requires host network)
    # network_mode: host
    restart: "no"

  # Optional: Local REST server as backup target
  # Uncomment to use a local restic REST server
  # rest-server:
  #   image: restic/rest-server:latest
  #   container_name: rest-server
  #   environment:
  #     - OPTIONS=--no-auth
  #   volumes:
  #     - ${REST_SERVER_DATA:-./backups}:/data
  #   ports:
  #     - "8000:8000"
  #   restart: unless-stopped
